[TOC]
# åŸå‹æ¨¡å¼

## å®šä¹‰
ç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶é€šè¿‡æ‹·è´è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå±äºåˆ›å»ºè€…æ¨¡å¼ç±»å‹ã€‚
![](vx_images/5635447150450.png)
## ä½œç”¨å’Œå®ç°

åŸå‹æ¨¡å¼ä¸»è¦ç”¨äºå¯¹è±¡çš„å¤åˆ¶ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯å°±æ˜¯ç±»å›¾ä¸­çš„åŸå‹ç±»Prototypeã€‚Prototypeç±»éœ€è¦å…·å¤‡ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š

* å®ç°Cloneableæ¥å£ã€‚Cloneableæ¥å£çš„ä½œç”¨æ˜¯åœ¨è¿è¡Œæ—¶é€šçŸ¥è™šæ‹Ÿæœºå¯ä»¥å®‰å…¨è¿è¡Œå®ç°äº†æ­¤æ¥å£çš„ç±»çš„cloneï¼ˆï¼‰æ–¹æ³•ã€‚å³ï¼Œåªæœ‰å®ç°äº†è¿™ä¸ªæ¥å£çš„å¯¹è±¡æ‰å¯ä»¥è¢«æ‹·è´ï¼Œå¦åˆ™åœ¨è¿è¡Œæ—¶ä¼šæŠ›å‡ºCloneNotSupportExceptionå¼‚å¸¸ã€‚
* é‡å†™Objectç±»ä¸­çš„cloneï¼ˆï¼‰æ–¹æ³•ï¼Œæ­¤æ–¹æ³•çš„ä½œç”¨åŸŸæ˜¯protedtedç±»å‹ï¼Œä¸€èˆ¬çš„ç±»æ— æ³•ä½¿ç”¨ï¼Œå› æ­¤ï¼ŒPrototypeç±»éœ€è¦å°†cloneçš„ä½œç”¨åŸŸä¿®æ”¹ä¸ºpublicç±»å‹ã€‚


## æ¡ˆä¾‹

### é—®é¢˜æè¿°

å…‹éš†ç¾Šé—®é¢˜ï¼šç°åœ¨æœ‰ä¸€åªç¾Š tomï¼Œå§“åä¸º: tom, å¹´é¾„ä¸ºï¼š1ï¼Œè¯·ç¼–å†™ç¨‹åºåˆ›å»ºå’Œ tom ç¾Š å±æ€§å®Œå…¨ç›¸åŒçš„ 4åªç¾Šã€‚

### æ–¹æ¡ˆä¸€

ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼åˆ›å»ºï¼Œåˆ›å»ºä¸€ä¸ªğŸç±»ï¼Œç„¶åå†ä¸»ç¨‹åºä¸­new4åªä¸€æ ·çš„ç¾Šï¼Œä¼˜ç‚¹æ˜¯ç®€å•ã€å¥½ç†è§£ï¼Œç¼ºç‚¹æ˜¯æ•ˆç‡ä½ï¼Œéœ€è¦åŠ¨æ€åˆå§‹åŒ–å¯¹è±¡ã€‚

```java
public class Sheep {

    private String name;
    private int age;

    public Sheep(String name, int age) {
        this.name = name;
        this.age = age;
    }

    @Override
    public String toString() {
        return "Sheep{" +
                "name='" + name + '\'' +
                ", age=" + age +
                '}';
    }

}

public class Main {
    
    public static void main(String[] args) {
        Sheep sheep1 = new Sheep("tom",1);
        Sheep sheep2 = new Sheep("tom",1);
        Sheep sheep3 = new Sheep("tom",1);
        Sheep sheep4 = new Sheep("tom",1);
    }
}
```

### æ–¹æ¡ˆäºŒ

ä½¿ç”¨åŸå‹æ¨¡å¼ï¼Œè®©Sheepç±»å®ç°Cloneableæ¥å£å¹¶é‡å†™cloneæ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨å¯¹è±¡çš„cloneæ–¹æ³•å®ç°å…‹éš†æ“ä½œã€‚

```java
public class Sheep implements Cloneable {

    private String name;
    private int age;

    public Sheep(String name, int age) {
        this.name = name;
        this.age = age;
    }

    @Override
    public String toString() {
        return "Sheep{" +
                "name='" + name + '\'' +
                ", age=" + age +
                '}';
    }

    @Override
    public Object clone() {
        Sheep sheep = null;
        try {
            sheep = (Sheep) super.clone();
        } catch (Exception e){
            System.out.println(e.getMessage());
        }
        return sheep;
    }
}

public class Main {

    public static void main(String[] args) {
        Sheep sheep1 = new Sheep("tom",1);
        Sheep sheep2 = (Sheep) sheep1.clone();
        Sheep sheep3 = (Sheep) sheep1.clone();
        Sheep sheep4 = (Sheep) sheep1.clone();
    }
}
```

## åŸå‹æ¨¡å¼çš„ä¼˜ç‚¹åŠä½¿ç”¨åœºæ™¯

ä½¿ç”¨åŸå‹æ¨¡å¼åˆ›å»ºå¯¹è±¡æ¯”ç›´æ¥newä¸€ä¸ªå¯¹è±¡åœ¨æ€§èƒ½ä¸Šè¦å¥½çš„å¤šï¼Œå› ä¸ºObjectç±»çš„cloneæ–¹æ³•æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå®ƒç›´æ¥æ“ä½œå†…å­˜ä¸­çš„äºŒè¿›åˆ¶æµï¼Œç‰¹åˆ«æ˜¯å¤åˆ¶å¤§å¯¹è±¡æ—¶ï¼Œæ€§èƒ½çš„å·®åˆ«éå¸¸æ˜æ˜¾ã€‚

ä½¿ç”¨åŸå‹æ¨¡å¼çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ç®€åŒ–å¯¹è±¡çš„åˆ›å»ºï¼Œä½¿å¾—åˆ›å»ºå¯¹è±¡å°±åƒæˆ‘ä»¬åœ¨ç¼–è¾‘æ–‡æ¡£æ—¶çš„å¤åˆ¶ç²˜è´´ä¸€æ ·ç®€å•ã€‚

å› ä¸ºä»¥ä¸Šä¼˜ç‚¹ï¼Œæ‰€ä»¥åœ¨éœ€è¦é‡å¤åœ°åˆ›å»ºç›¸ä¼¼å¯¹è±¡æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨åŸå‹æ¨¡å¼ã€‚æ¯”å¦‚éœ€è¦åœ¨ä¸€ä¸ªå¾ªç¯ä½“å†…åˆ›å»ºå¯¹è±¡ï¼Œå‡å¦‚å¯¹è±¡åˆ›å»ºè¿‡ç¨‹æ¯”è¾ƒå¤æ‚æˆ–è€…å¾ªç¯æ¬¡æ•°å¾ˆå¤šçš„è¯ï¼Œä½¿ç”¨åŸå‹æ¨¡å¼ä¸ä½†å¯ä»¥ç®€åŒ–åˆ›å»ºè¿‡ç¨‹ï¼Œè€Œä¸”å¯ä»¥ä½¿ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½æé«˜å¾ˆå¤šã€‚

## æ³¨æ„äº‹é¡¹

* ä½¿ç”¨åŸå‹æ¨¡å¼å¤åˆ¶å¯¹è±¡ä¸ä¼šè°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ã€‚å› ä¸ºå¯¹è±¡çš„å¤åˆ¶æ˜¯é€šè¿‡è°ƒç”¨Objectç±»çš„cloneæ–¹æ³•æ¥å®Œæˆçš„ï¼Œå®ƒç›´æ¥åœ¨å†…å­˜ä¸­å¤åˆ¶æ•°æ®ï¼Œå› æ­¤ä¸ä¼šè°ƒç”¨åˆ°ç±»çš„æ„é€ æ–¹æ³•ã€‚ä¸ä½†æ„é€ æ–¹æ³•ä¸­çš„ä»£ç ä¸ä¼šæ‰§è¡Œï¼Œç”šè‡³è¿è®¿é—®æƒé™éƒ½å¯¹åŸå‹æ¨¡å¼æ— æ•ˆã€‚è¿˜è®°å¾—å•ä¾‹æ¨¡å¼å—ï¼Ÿå•ä¾‹æ¨¡å¼ä¸­ï¼Œåªè¦å°†æ„é€ æ–¹æ³•çš„è®¿é—®æƒé™è®¾ç½®ä¸ºprivateå‹ï¼Œå°±å¯ä»¥å®ç°å•ä¾‹ã€‚ä½†æ˜¯cloneæ–¹æ³•ç›´æ¥æ— è§†æ„é€ æ–¹æ³•çš„æƒé™ï¼Œæ‰€ä»¥ï¼Œå•ä¾‹æ¨¡å¼ä¸åŸå‹æ¨¡å¼æ˜¯å†²çªçš„ï¼Œåœ¨ä½¿ç”¨æ—¶è¦ç‰¹åˆ«æ³¨æ„ã€‚

* æ·±æ‹·è´ä¸æµ…æ‹·è´ã€‚Objectç±»çš„cloneæ–¹æ³•åªä¼šæ‹·è´å¯¹è±¡ä¸­çš„åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå¯¹äºæ•°ç»„ã€å®¹å™¨å¯¹è±¡ã€å¼•ç”¨å¯¹è±¡ç­‰éƒ½ä¸ä¼šæ‹·è´ï¼Œè¿™å°±æ˜¯æµ…æ‹·è´ã€‚å¦‚æœè¦å®ç°æ·±æ‹·è´ï¼Œå¿…é¡»å°†åŸå‹æ¨¡å¼ä¸­çš„æ•°ç»„ã€å®¹å™¨å¯¹è±¡ã€å¼•ç”¨å¯¹è±¡ç­‰å¦è¡Œæ‹·è´ã€‚

## æ·±æ‹·è´ä¸æµ…æ‹·è´


### æµ…æ‹·è´

* å¯¹äºæ•°æ®ç±»å‹æ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œæµ…æ‹·è´ä¼šç›´æ¥è¿›è¡Œå€¼ä¼ é€’ï¼Œå°†è¯¥å±æ€§çš„å±æ€§å€¼å¤åˆ¶ä¸€ä»½ç»™æ–°çš„å¯¹è±¡ã€‚
* å¯¹äºæ•°æ®ç±»å‹æ˜¯å¼•ç”¨æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œæµ…æ‹·è´ä¼šè¿›è¡Œå¼•ç”¨ä¼ é€’ï¼Œå°†å¯¹è±¡çš„å†…å­˜åœ°å€å¤åˆ¶ä¸€ä»½ç»™æ–°çš„å¯¹è±¡ï¼Œå› æ­¤ï¼Œä¸¤ä»½å¯¹è±¡çš„å¼•ç”¨æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ä¿®æ”¹æ”¹æˆå‘˜å˜é‡ä¼šå½±å“å¦ä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡ã€‚
* å‰é¢çš„ä½¿ç”¨é»˜è®¤çš„cloneæ–¹æ³•æ˜¯æµ…æ‹·è´ã€‚
![](vx_images/472843178876.png)
### æ·±æ‹·è´

æ·±æ‹·è´ä¸ä»…ä¼šèµ‹å€¼æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡å€¼ï¼Œå¯¹äºå¼•ç”¨æ•°æ®ç±»å‹ä¹Ÿä¼šå°†å¯¹è±¡åœ¨å†…å­˜ä¸­å¤åˆ¶ä¸€ä»½ï¼Œå³ï¼Œå°†å¼•ç”¨æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ä»¥åŠæ‰€æœ‰çš„å¯è¾¾å¯¹è±¡éƒ½åœ¨å†…å­˜ä¸­å¤åˆ¶ä¸€ä»½ï¼Œè€Œä¸åªæ˜¯å¤åˆ¶å†…å­˜åœ°å€ã€‚

![](vx_images/4578543166743.png)

å®ç°æ–¹æ³•ï¼š
* é‡å†™cloneæ–¹æ³•å®ç°æ·±æ‹·è´
* é€šè¿‡å¯¹è±¡åºåˆ—åŒ–å®ç°æ·±æ‹·è´ï¼ˆæ¨èï¼‰ã€‚

### æ·±æ‹·è´å®ç°å…‹éš†ç¾Š


```java
//æ·±æ‹·è´ä¸­çš„å¼•ç”¨æ•°æ®ç±»ä¹Ÿè¦å®ç°Cloneableæ¥å£å’ŒSerializableæ¥å£
public class Sheep implements Cloneable,Serializable{

    private String name;
    private int age;

    public Sheep(String name, int age) {
        this.name = name;
        this.age = age;
    }

    @Override
    public String toString() {
        return "Sheep{" +
                "name='" + name + '\'' +
                ", age=" + age +
                '}';
    }

    
    @Override
    public Object clone() {
        Sheep sheep = null;
        try {
            sheep = (Sheep) super.clone();
        } catch (Exception e){
            System.out.println(e.getMessage());
        }
        return sheep;
    }
}

class SheepPerson implements Cloneable, Serializable {
    private String name;

    private Sheep sheep;

    public SheepPerson(String name, Sheep sheep) {
        this.name = name;
        this.sheep = sheep;
    }

    //ç¬¬ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡é‡å†™cloneæ–¹æ³•å®ç°æ·±æ‹·è´
    @Override
    public Object clone()  {
        SheepPerson sheepPerson = null;
        try{
            sheepPerson = (SheepPerson) super.clone();
            //å°†è¦æ·±æ‹·è´çš„å¯¹è±¡ä¸­çš„å¼•ç”¨æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ä¹Ÿè¿›è¡Œæ‹·è´ã€‚
            sheepPerson.sheep = (Sheep) sheep.clone();
        } catch (Exception e){
            System.out.println(e.getMessage());
        }
        return sheepPerson;
    }

    //æ–¹æ³•äºŒï¼Œé€šè¿‡å¯¹è±¡åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°æ·±æ‹·è´
    public Object deepClone() {
        ByteArrayOutputStream bos = null;
        ObjectOutputStream oos = null;
        ByteArrayInputStream bis = null;
        ObjectInputStream ois = null;
        try {
            bos = new ByteArrayOutputStream();
            oos = new ObjectOutputStream(bos);
            oos.writeObject(this);
            bis = new ByteArrayInputStream(bos.toByteArray());
            ois = new ObjectInputStream(bis);
            SheepPerson cloneObject = (SheepPerson) ois.readObject();
            return cloneObject;
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        } finally {
            try {
                bos.close();
                oos.close();
                bis.close();
                ois.close();
            } catch (IOException e) {
                e.printStackTrace();
            }

        }
    }
}
```

### æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚

* é€šè¿‡é‡å†™cloneæ–¹æ³•å®ç°æ·±æ‹·è´æ—¶ï¼Œå¦‚æœå¯¹è±¡ä¸­æœ‰å¾ˆå¤šå¼•ç”¨æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œè¦å¯¹æ¯ä¸€ä¸ªæˆå‘˜å˜é‡éƒ½è¿›è¡Œæ‹·è´ï¼Œå› æ­¤æ­¤æ–¹æ³•é€‚ç”¨äºå†…éƒ¨å¼•ç”¨æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡è¾ƒå°‘æ—¶ä½¿ç”¨ã€‚
* é€šè¿‡å¯¹è±¡åºåˆ—åŒ–å®ç°æ·±æ‹·è´æ— éœ€æ‹·è´æ¯ä¸ªæˆå‘˜å˜é‡ï¼Œåªéœ€è¦å¯¹thiså¯¹è±¡åºåˆ—åŒ–ä¸ååºåˆ—åŒ–å³å¯ï¼Œä¸€åŠ³æ°¸é€¸ã€‚
* å½“åˆ›å»ºæ–°çš„å¯¹è±¡æ¯”è¾ƒå¤æ‚æ˜¯ï¼Œå¯ä»¥é€šè¿‡åŸå‹æ¨¡å¼ç®€åŒ–å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼ŒåŒæ—¶ä¹Ÿèƒ½æå‡æ•ˆç‡ã€‚
* ä¸ç”¨é‡æ–°åˆå§‹åŒ–å¯¹è±¡ï¼Œè€Œæ˜¯åŠ¨æ€è·å–è¿è¡Œæ—¶çš„çŠ¶æ€ï¼Œ
* å¦‚æœåŸå§‹å¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼Œå…¶ä»–å…‹éš†å¯¹è±¡ä¹Ÿä¼šå‘ç”Ÿç›¸åº”çš„å˜åŒ–ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚
* `ç¼ºç‚¹`ï¼šéœ€è¦ä¸ºæ¯ä¸€ä¸ªç±»é‡å†™ä¸€ä¸ªå…‹éš†æ–¹æ³•ï¼Œå¦‚æœè¦å¯¹å·²æœ‰çš„ç±»è¿›è¡Œæ”¹é€ éœ€è¦ä¿®æ”¹å…¶æºä»£ç ï¼Œ`è¿èƒŒäº†OCPåŸåˆ™`ã€‚


